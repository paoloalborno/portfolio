<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate-key="cv.title"></title>
    <meta name="description" content="" data-translate-key="cv.meta_description">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .highlight-entry {
            background-color: rgba(102, 126, 234, 0.1);
            transition: background-color 0.3s ease;
        }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <main>
        <section class="cv-page" style="padding-top: 120px;">
            <div class="container">
                <div class="cv-header" data-aos="fade-in">
                    <h1 class="cv-title" data-translate-key="cv.main_title">Curriculum Vitae</h1>
                    <p class="cv-subtitle" data-translate-key="cv.main_subtitle">Un percorso professionale nel mondo del software e dei dati.</p>
                </div>

                <div class="cv-grid-container">
                    <div class="cv-left-column" id="cv-text-container">
                        <!-- Content will be generated by JavaScript -->
                    </div>
                    <div class="cv-right-column">
                        <div id="cv-graph"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="footer-placeholder"></div>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="//unpkg.com/force-graph"></script>
    <script src="js/cv_data.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            AOS.init({
                duration: 800,
                once: true
            });

            // --- 1. Generate CV Text from Data ---
            const cvContainer = document.getElementById('cv-text-container');

            const sections = {
                experience: { title: 'Esperienze Lavorative', 'data-translate-key': 'cv.work_experience_title' },
                education: { title: 'Istruzione e Formazione', 'data-translate-key': 'cv.education_title' },
                certifications: { title: 'Certificazioni', 'data-translate-key': 'cv.certifications_title' }
            };

            for (const sectionKey in sections) {
                const sectionData = cvData[sectionKey];
                if (sectionData && sectionData.length > 0) {
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'cv-section';
                    sectionDiv.setAttribute('data-aos', 'fade-up');

                    const title = document.createElement('h2');
                    title.className = 'cv-section-title';
                    title.textContent = sections[sectionKey].title;
                    title.setAttribute('data-translate-key', sections[sectionKey]['data-translate-key']);
                    sectionDiv.appendChild(title);

                    sectionData.forEach(item => {
                        const entryDiv = document.createElement('div');
                        entryDiv.className = 'cv-entry';
                        entryDiv.id = item.id;

                        let entryHTML = `
                            <div class="cv-entry-header">
                                <h3 class="cv-entry-title">${item.title}</h3>
                                ${item.date ? `<span class="cv-entry-date">${item.date}</span>` : ''}
                            </div>
                            ${item.company ? `<p class="cv-entry-company">${item.company}</p>` : ''}
                        `;

                        if (item.details && item.details.length > 0) {
                            entryHTML += `<div class="cv-entry-details"><ul>`;
                            item.details.forEach(detail => {
                                entryHTML += `<li>${detail}</li>`;
                            });
                            entryHTML += `</ul></div>`;
                        }

                        entryDiv.innerHTML = entryHTML;
                        sectionDiv.appendChild(entryDiv);
                    });
                    cvContainer.appendChild(sectionDiv);
                }
            }

            // --- 2. Generate Graph Data from CV Data ---
            const gData = { nodes: [], links: [] };
            const mainNode = { id: 'Paolo Alborno', group: 'core', val: 4 };
            gData.nodes.push(mainNode);

            // Add categories
            for (const sectionKey in sections) {
                const node = { id: sections[sectionKey].title, group: 'category', val: 3 };
                gData.nodes.push(node);
                gData.links.push({ source: mainNode.id, target: node.id });
            }

            // Add items and link to categories
            for (const sectionKey in cvData) {
                cvData[sectionKey].forEach(item => {
                    gData.nodes.push({ id: item.title, group: sectionKey, val: 2, refId: item.id });
                    gData.links.push({ source: sections[sectionKey].title, target: item.title });
                });
            }

            // --- 3. Initialize Graph with Interactivity ---
            const graphColors = {
                core: '#5a67d8',
                category: '#667eea',
                experience: '#764ba2',
                education: '#764ba2',
                certs: '#f5576c',
            };

            let highlightedNode = null;
            let highlightedElement = null;

            const Graph = ForceGraph()
                (document.getElementById('cv-graph'))
                .graphData(gData)
                .nodeId('id')
                .nodeVal('val')
                .nodeLabel('id')
                .nodeAutoColorBy('group')
                .linkSource('source')
                .linkTarget('target')
                .width(document.getElementById('cv-graph').offsetWidth)
                .height(document.getElementById('cv-graph').offsetHeight)
                .backgroundColor('rgba(0,0,0,0)')
                .onNodeHover(node => {
                    if (highlightedElement) {
                        highlightedElement.classList.remove('highlight-entry');
                    }
                    if (node && node.refId) {
                        const el = document.getElementById(node.refId);
                        if (el) {
                            el.classList.add('highlight-entry');
                            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            highlightedElement = el;
                        }
                    }
                })
                .nodeCanvasObject((node, ctx, globalScale) => {
                    const label = node.id;
                    const fontSize = 12 / globalScale;
                    ctx.font = `${fontSize}px Sans-Serif`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillStyle = graphColors[node.group] || '#2d3748';
                    ctx.fillText(label, node.x, node.y);
                });
        });
    </script>
    <script src="js/translations.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
